[gd_scene load_steps=29 format=3 uid="uid://s3w1eg52kr8u"]

[ext_resource type="Script" uid="uid://dq73tw5i6mbrk" path="res://scripts/world_generation/World.cs" id="1_132vp"]
[ext_resource type="Shader" uid="uid://cejnfr3nmlr6a" path="res://scenes/world_generation/world.gdshader" id="2_s0qqk"]
[ext_resource type="Resource" uid="uid://bfks6ydjmu5gu" path="res://resources/tile_config.tres" id="2_w0i7v"]
[ext_resource type="PackedScene" uid="uid://c6lr8f133tbfv" path="res://scenes/world_generation/shrines/racoon_shrine.tscn" id="3_klido"]
[ext_resource type="Script" uid="uid://bvu271y34tacx" path="res://scripts/world_generation/pipeline/WorldGenerationPipelineManager.cs" id="4_pfpup"]
[ext_resource type="Texture2D" uid="uid://dqep2vtnrtql8" path="res://assets/tile_sets/base_layer_terrain/spritesheet_nature-blocks.png" id="4_wyppg"]
[ext_resource type="Shader" uid="uid://r3xjxg7c3bx7" path="res://assets/shaders/tree.gdshader" id="5_itp5q"]
[ext_resource type="Script" uid="uid://csuwanyvgyjhk" path="res://scripts/world_generation/pipeline/logical_stages/GenerateTerrainStage.cs" id="6_132vp"]
[ext_resource type="Texture2D" uid="uid://bf15ar37swfr2" path="res://assets/tile_sets/object_layer_terrain/IPN_Atlas_lower_res.png" id="6_fgma2"]
[ext_resource type="Script" uid="uid://bh1fwevuond4k" path="res://scenes/world_generation/ObstacleLayer.cs" id="7_fgma2"]
[ext_resource type="Script" uid="uid://xwgx2tol2mjl" path="res://scripts/world_generation/pipeline/logical_stages/FindIslandsStage.cs" id="7_gubng"]
[ext_resource type="Script" uid="uid://bsr4viawm7cxa" path="res://scripts/world_generation/pipeline/logical_stages/FindConnectionsStage.cs" id="8_ysaxy"]
[ext_resource type="Script" uid="uid://dwk5hwtddjr83" path="res://scripts/world_generation/pipeline/logical_stages/ConnectIslandsStage.cs" id="9_s0qqk"]
[ext_resource type="Script" uid="uid://bidoh4v7k13r5" path="res://scripts/world_generation/pipeline/logical_stages/MarkShrinesStage.cs" id="10_tmpep"]
[ext_resource type="Script" uid="uid://bihhuhy5y2wt8" path="res://scripts/world_generation/pipeline/physical_stages/RenderTilesStage.cs" id="11_fgma2"]
[ext_resource type="Script" uid="uid://buoasp8jr4q8d" path="res://scripts/world_generation/pipeline/logical_stages/FindPlayerSpawnStage.cs" id="13_n115m"]
[ext_resource type="Script" uid="uid://du8smpfyvpfos" path="res://scripts/world_generation/pipeline/physical_stages/SpawnShrinesStage.cs" id="14_sqldb"]
[ext_resource type="Script" uid="uid://cfcxf7vnuqjhj" path="res://scripts/world_generation/pipeline/physical_stages/SpawnChestsStage.cs" id="15_gubng"]
[ext_resource type="PackedScene" uid="uid://drylev6qbp30i" path="res://scenes/chest/TreasureChest.tscn" id="16_ysaxy"]
[ext_resource type="Shader" uid="uid://dedyvaqponlc" path="res://scenes/world_generation/player_vignette.gdshader" id="19_tmpep"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_fgma2"]
shader = ExtResource("19_tmpep")
shader_parameter/alpha = 1.0
shader_parameter/inner_radius = 0.0
shader_parameter/outer_radius = 1.6

[sub_resource type="ShaderMaterial" id="ShaderMaterial_tmpep"]
shader = ExtResource("2_s0qqk")
shader_parameter/diamond_size = 0.3
shader_parameter/fade_width = 0.05
shader_parameter/border_color = Color(0, 0, 0, 1)

[sub_resource type="TileSetAtlasSource" id="TileSetAtlasSource_132vp"]
texture = ExtResource("4_wyppg")
texture_region_size = Vector2i(140, 140)
3:0/0 = 0
3:0/0/texture_origin = Vector2i(0, -17)
4:0/0 = 0
4:0/0/texture_origin = Vector2i(0, -14)
5:0/0 = 0
5:0/0/texture_origin = Vector2i(0, -14)
12:0/0 = 0
12:0/0/texture_origin = Vector2i(-2, -14)
13:0/0 = 0
13:0/0/texture_origin = Vector2i(0, -15)
14:0/0 = 0
2:0/next_alternative_id = 4
2:0/0 = 0
2:0/0/texture_origin = Vector2i(0, -14)
2:0/1 = 1
2:0/1/flip_h = true
2:0/1/texture_origin = Vector2i(3, -14)
1:0/next_alternative_id = 2
1:0/0 = 0
1:0/0/texture_origin = Vector2i(0, -14)
0:0/0 = 0
0:0/0/texture_origin = Vector2i(0, -16)
6:0/0 = 0
6:0/0/texture_origin = Vector2i(0, -14)
7:0/0 = 0
7:0/0/texture_origin = Vector2i(0, -14)
8:0/0 = 0
8:0/0/texture_origin = Vector2i(-2, -12)
9:0/0 = 0
9:0/0/texture_origin = Vector2i(-3, -14)
10:0/0 = 0
10:0/0/texture_origin = Vector2i(-1, -9)
11:0/0 = 0
11:0/0/texture_origin = Vector2i(-1, -12)
15:0/0 = 0
15:0/0/texture_origin = Vector2i(-3, -14)

[sub_resource type="TileSet" id="TileSet_nmbn7"]
tile_shape = 1
tile_layout = 5
tile_offset_axis = 1
tile_size = Vector2i(120, 90)
sources/0 = SubResource("TileSetAtlasSource_132vp")

[sub_resource type="ShaderMaterial" id="ShaderMaterial_683jg"]
shader = ExtResource("5_itp5q")
shader_parameter/wind_strength = 0.2000000095
shader_parameter/wind_speed = 1.5000000712500001
shader_parameter/player_position = Vector2(0, 0)
shader_parameter/transparency_radius = 150.0
shader_parameter/fade_width = 50.0

[sub_resource type="TileSetAtlasSource" id="TileSetAtlasSource_n115m"]
texture = ExtResource("6_fgma2")
margins = Vector2i(29, 23)
separation = Vector2i(8, 0)
texture_region_size = Vector2i(120, 200)
0:0/0 = 0
0:0/0/texture_origin = Vector2i(4, 70)
0:0/0/physics_layer_0/polygon_0/points = PackedVector2Array(0, -22.5, -30, 0, 0, 22.5, 30, 0)
1:0/0 = 0
1:0/0/texture_origin = Vector2i(1, 77)
1:0/0/physics_layer_0/polygon_0/points = PackedVector2Array(0, -22.5, -30, 0, 0, 22.5, 30, 0)
2:0/0 = 0
2:0/0/texture_origin = Vector2i(4, 75)
2:0/0/physics_layer_0/polygon_0/points = PackedVector2Array(0, -22.5, -30, 0, 0, 22.5, 30, 0)
3:0/0 = 0
3:0/0/texture_origin = Vector2i(-4, 65)
3:0/0/physics_layer_0/polygon_0/points = PackedVector2Array(0, -22.5, -30, 0, 0, 22.5, 30, 0)

[sub_resource type="TileSet" id="TileSet_vbebb"]
tile_shape = 1
tile_layout = 5
tile_offset_axis = 1
tile_size = Vector2i(60, 45)
physics_layer_0/collision_layer = 3
physics_layer_0/collision_mask = 3
sources/1 = SubResource("TileSetAtlasSource_n115m")

[sub_resource type="Curve" id="Curve_xnpr7"]
_data = [Vector2(0, 0), 0.0, 0.0, 0, 0, Vector2(0.5510204, 1), 0.0, 0.0, 0, 0, Vector2(1, 0), 0.0, 0.0, 0, 0]
point_count = 3

[node name="World" type="Node2D" node_paths=PackedStringArray("_worldGenPipelineManger")]
y_sort_enabled = true
script = ExtResource("1_132vp")
_worldGenPipelineManger = NodePath("GenerationPipeline")
metadata/_edit_horizontal_guides_ = [-21.0]

[node name="CanvasLayer2" type="CanvasLayer" parent="."]

[node name="PlayerVignette" type="ColorRect" parent="CanvasLayer2"]
material = SubResource("ShaderMaterial_fgma2")
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2

[node name="CanvasLayer" type="CanvasLayer" parent="."]
follow_viewport_enabled = true

[node name="MapBorderVignette" type="ColorRect" parent="CanvasLayer"]
material = SubResource("ShaderMaterial_tmpep")
offset_left = -9636.0
offset_top = -2976.0
offset_right = 9772.0
offset_bottom = 11826.0
mouse_filter = 2

[node name="BaseLayer" type="TileMapLayer" parent="."]
z_index = -1
y_sort_enabled = true
tile_set = SubResource("TileSet_nmbn7")

[node name="ObstacleLayer" type="TileMapLayer" parent="." groups=["Obstacle"]]
z_index = 10
material = SubResource("ShaderMaterial_683jg")
scale = Vector2(2, 2)
tile_set = SubResource("TileSet_vbebb")
rendering_quadrant_size = 64
script = ExtResource("7_fgma2")

[node name="GenerationPipeline" type="Node" parent="."]
script = ExtResource("4_pfpup")

[node name="GenerateTerrainStage" type="Node" parent="GenerationPipeline"]
script = ExtResource("6_132vp")
_stateProbabilities = PackedFloat32Array(0.5, 0.5)
_smoothingNeighborDepth = 2
_numSmooths = 4

[node name="FindIslandsStage" type="Node" parent="GenerationPipeline"]
script = ExtResource("7_gubng")

[node name="FindConnectionsStage" type="Node" parent="GenerationPipeline"]
script = ExtResource("8_ysaxy")

[node name="ConnectIslandsStage" type="Node" parent="GenerationPipeline"]
script = ExtResource("9_s0qqk")
_pathCurve = SubResource("Curve_xnpr7")
_pathRadius = 3
_pathCurveMagnitude = 5

[node name="MarkShrinesStage" type="Node" parent="GenerationPipeline"]
script = ExtResource("10_tmpep")
_numShrines = 3
_shrineSizeCols = 13
_shrineSizeRows = 13
_minDistance = 50

[node name="RenderTilesStage" type="Node" parent="GenerationPipeline" node_paths=PackedStringArray("_baseTileMapLayer", "_obstacleTileMapLayer")]
script = ExtResource("11_fgma2")
_baseTileMapLayer = NodePath("../../BaseLayer")
_obstacleTileMapLayer = NodePath("../../ObstacleLayer")
_tileConfig = ExtResource("2_w0i7v")
_borderSize = 5

[node name="SpawnChestsStage" type="Node" parent="GenerationPipeline"]
script = ExtResource("15_gubng")
_chestPackedScene = ExtResource("16_ysaxy")

[node name="SpawnShrinesStage" type="Node" parent="GenerationPipeline"]
script = ExtResource("14_sqldb")
_allShrinePackedScenes = Array[PackedScene]([ExtResource("3_klido"), ExtResource("3_klido"), ExtResource("3_klido")])

[node name="FindPlayerSpawnStage" type="Node" parent="GenerationPipeline"]
script = ExtResource("13_n115m")
